deptrac:
    paths:
        - ./src
    exclude_files:
        - '#.*test.*#'
    layers:
        -
            name: Infrastructure
            collectors:
                -
                    type: classNameRegex
                    value: '#^App\\[^\\]+\\Infrastructure\\.*#'
        -
            name: Domain
            collectors:
                -
                    type: classNameRegex
                    value: '#^App\\[^\\]+\\Domain\\.*#'
        -
            name: Application
            collectors:
                -
                    type: classNameRegex
                    value: '#^App\\[^\\]+\\Application\\.*#'
        -   name: Symfony UUID
            collectors:
                -   type: classNameRegex
                    value: '#^Symfony\\Component\\Uid\\Uuid$#'
        -   name: Symfony
            collectors:
                -   type: bool
                    must:
                        -   type: classNameRegex
                            value: ~^Symfony\\~
                    must_not:
                        -   type: classNameRegex
                            value: '#^Symfony\\Component\\Uid\\Uuid$#'
                        -   type: classNameRegex
                            value: '#^Symfony\\Bridge\\Doctrine\\Types\\.+$#'
                        -   type: classNameRegex
                            value: '#^Symfony\\Component\\Messenger\\Attribute\\.+$#'

        -   name: Doctrine mappings
            collectors:
                -   type: classNameRegex
                    value: '#^Doctrine\\ORM\\Mapping\\.+$#'
                -   type: classNameRegex
                    value: '#^Symfony\\Bridge\\Doctrine\\Types\\.+$#'
                -   type: classNameRegex
                    value: '#^Doctrine\\DBAL\\Types\\Types$#'

        -   name: Doctrine
            collectors:
                - type: bool
                  must:
                      -   type: classNameRegex
                          value: ~^Doctrine\\~
                  must_not:
                      -   type: classNameRegex
                          value: '#^Doctrine\\ORM\\Mapping\\.+$#'
                      -   type: classNameRegex
                          value: '#^Doctrine\\DBAL\\Types\\Types$#'
                      -   type: classNameRegex
                          value: '#^Doctrine\\Common\\Collections\\.+$#'

        -   name: Doctrine collections
            collectors:
                - type: classNameRegex
                  value: '#^Doctrine\\Common\\Collections\\.+$#'

        -   name: Webmozart assert
            collectors:
                -   type: classNameRegex
                    value: ~^Webmozart\\~

        - name: Symfony events & messenger attributes
          collectors:
                -  type: classNameRegex
                   value: '#^Symfony\\Component\\Messenger\\Attribute\\.+$#'

    ruleset:
        Infrastructure:
            - Domain
            - Application
            - Symfony
            - Symfony UUID
            - Doctrine
            - Webmozart assert
        Application:
            - Domain
            - Doctrine
            - Webmozart assert
            - Symfony events & messenger attributes
        Domain:
            - Symfony UUID
            - Doctrine mappings
            - Webmozart assert
            - Doctrine collections
